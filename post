from pyzabbix import ZabbixAPI
import pandas as pd

# Zabbix server credentials
zabbix_server = 'https://your_zabbix_server_url'
username = 'your_username'
password = 'your_password'

# Host group name to filter
host_group_name = 'Your Host Group Name'

# Connect to Zabbix API
zapi = ZabbixAPI(zabbix_server)
zapi.login(username, password)

# Get the host group ID
host_groups = zapi.hostgroup.get(filter={'name': host_group_name})
if not host_groups:
    print(f"Host group '{host_group_name}' not found.")
    exit()
host_group_id = host_groups[0]['groupid']

# Get hosts in the host group
hosts = zapi.host.get(groupids=host_group_id, output=['hostid', 'host', 'status'])

# Initialize list to store data
data = []

# Fetch items, triggers, and media for each host
for host in hosts:
    host_id = host['hostid']
    host_name = host['host']
    host_status = 'Enabled' if host['status'] == '0' else 'Disabled'
    
    items = zapi.item.get(hostids=host_id, output=['name', 'status', 'delay'])
    triggers = zapi.trigger.get(hostids=host_id, output=['priority', 'status', 'description'])
    media = zapi.usermedia.get(userid=host_id, output=['mediatypeid', 'sendto'])

    for item in items:
        item_name = item['name']
        item_status = 'Enabled' if item['status'] == '0' else 'Disabled'
        item_interval = item['delay']
        
        for trigger in triggers:
            trigger_severity = trigger['priority']
            trigger_status = 'Enabled' if trigger['status'] == '0' else 'Disabled'
            
            for medium in media:
                media_type = medium['mediatypeid']
                media_sendto = medium['sendto']
                
                data.append([
                    host_name,
                    host_status,
                    item_name,
                    item_interval,
                    item_status,
                    trigger_severity,
                    trigger_status,
                    media_type,
                    media_sendto
                ])

# Create a DataFrame and save it to an Excel file
columns = ['Host Name', 'Host Status', 'Item Name', 'Item Interval', 'Item Status', 'Trigger Severity', 'Trigger Status', 'Media Type', 'Media Sendto']
df = pd.DataFrame(data, columns=columns)
df.to_excel('zabbix_data.xlsx', index=False)

print("Data has been successfully saved to 'zabbix_data.xlsx'.")
