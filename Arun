from pyzabbix import ZabbixAPI, ZabbixAPIException
import csv

# Zabbix server credentials
zabbix_url = 'https://your_zabbix_server_url/zabbix'
zabbix_user = 'your_username'
zabbix_password = 'your_password'

# Connect to Zabbix API
zapi = ZabbixAPI(zabbix_url)
zapi.login(zabbix_user, zabbix_password)

# Define the host group and fetch hosts
hostgroup_name = 'Your_Host_Group_Name'
hosts = zapi.host.get(group=hostgroup_name, output=['hostid', 'host', 'status'])

# Define the output CSV file name
csv_file_name = 'zabbix_host_status.csv'

# Convert status values to "Enabled" or "Disabled"
def convert_status(status):
    return 'Enabled' if status == '0' else 'Disabled'

# Write data to CSV file
with open(csv_file_name, mode='w', newline='') as file:
    writer = csv.writer(file)
    writer.writerow(['Host Name', 'Status'])
    for host in hosts:
        host_name = host['host']
        host_status = convert_status(host['status'])
        writer.writerow([host_name, host_status])

print(f"Report generated successfully: {csv_file_name}")

# Logout from Zabbix API
zapi.logout()
